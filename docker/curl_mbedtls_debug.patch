--- a/lib/vtls/mbedtls.c
+++ b/lib/vtls/mbedtls.c
@@ -552,8 +552,14 @@ mbedtls_connect_step1(struct Curl_cfilter *cf, struct Curl_easy *data)
   }

   mbedtls_ssl_init(&backend->ssl);
-  if(mbedtls_ssl_setup(&backend->ssl, &backend->config)) {
-    failf(data, "mbedTLS: ssl_init failed");
+
+  /* Configure RNG BEFORE ssl_setup (required in mbedTLS 3.x) */
+  mbedtls_ssl_conf_rng(&backend->config, mbedtls_ctr_drbg_random,
+                       &backend->ctr_drbg);
+
+  ret = mbedtls_ssl_setup(&backend->ssl, &backend->config);
+  if(ret) {
+    failf(data, "mbedTLS: ssl_setup failed (-0x%04X)", -ret);
     return CURLE_SSL_CONNECT_ERROR;
   }

@@ -589,8 +595,6 @@ mbedtls_connect_step1(struct Curl_cfilter *cf, struct Curl_easy *data)

   mbedtls_ssl_conf_authmode(&backend->config, MBEDTLS_SSL_VERIFY_OPTIONAL);

-  mbedtls_ssl_conf_rng(&backend->config, mbedtls_ctr_drbg_random,
-                       &backend->ctr_drbg);
   mbedtls_ssl_set_bio(&backend->ssl, cf, bio_cf_write, bio_cf_read,
                       NULL /*  rev_timeout() */);

